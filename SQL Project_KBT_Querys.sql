CREATE DATABASE SQL_PROJECT_PSP_COMPANY;
USE SQL_PROJECT_PSP_COMPANY;

/* ----- Create the tables ------ */
CREATE TABLE Merchants (
merchant_id INT NOT NULL,
merchant_name VARCHAR (155),
merchant_ruc BIGINT NOT NULL,
model_service VARCHAR (155),
PRIMARY KEY (merchant_id)
);

CREATE TABLE Transactions (
merchant_id INT NOT NULL,
month_trx VARCHAR (50),
gpv_usd FLOAT,
count_trx INT
);

CREATE TABLE RUC_segment (
merchant_ruc BIGINT NOT NULL,
segment VARCHAR (50)
);

/* ----- Insert data into tables ------ */
INSERT INTO Merchants (merchant_id, merchant_name, merchant_ruc, model_service)
VALUES
	(24342, 'Bodega Blanco', 20847258296, 'POS'),
	(24343, 'Movilidad Andros', 20612481970, 'POS'),
	(24344, 'Movilidad Flop', 20639073349, 'POS'),
	(24349, 'Bodega Musculares', 20983208130, 'POS'),
	(24352, 'Restaurante Reflector',20135448574, 'POS'),
	(24353, 'Mercado Piel',20771211723, 'Payment Gateway'),
	(24354, 'Mercado Piel',20771211723, 'Payment Gateway'),
	(24356, 'Movilidad Horno', 36117719, 'Payment Link'),
	(24357, 'Tienda Creativo', 20784634554, 'POS'),
	(24358, 'Restaurante Room', 20777222331, 'POS'),
	(24359, 'Tienda Contenta', 10652893, 'POS'),
	(24360, 'Chifa Tubo', 10358837873, 'POS'),
	(24363, 'Movilidad Canguros',10658253471, 'POS'),
	(24366, 'Restaurante Chiqui-',10598678465, 'POS'),
	(24373, 'Restaurante Moda',10661609432, 'POS'),
	(24377, 'Chifa Exclusiva', 10103950737, 'POS'),
	(24378, 'Movilidad Argentia',10659251085, 'POS'),
	(24379, 'Restaurante Compañero',10384816897,'POS'),
	(24380, 'Tienda Eólica', 10181431099, 'POS'),
	(24384, 'Movilidad Prototipo', 10520680879, 'POS'),
	(24385, 'Bodega Turbina', 10462520240, 'POS'),
	(24386, 'Tienda Enmarcar', 10116772074, 'POS'),
	(24389, 'Chifa Lista',10210030687, 'POS'),
	(24401, 'Movilidad Disciplinaria', 10431114886, 'POS'),
	(24407, 'Mercado Luces',75326399, 'POS'),
	(24409, 'Restaurante Gustos',10625782672, 'POS'),
	(24416, 'Chifa Cutis', 10566162740, 'POS'),
	(24417, 'Bodega Ladrido', 10436642592, 'POS'),
	(24419, 'Restaurante Modas',10988229106, 'POS'),
	(24424, 'Tienda Bases',10626077711, 'POS'),
	(24425, 'Mercado Espacial',10273073417, 'POS'),
	(24429, 'Tienda Despegues', 10901586976, 'POS'),
	(24430, 'Movilidad Rastro',10317494845, 'POS'),
	(24432, 'Tienda Compartidos', 10897248973, 'POS'),
	(24434, 'Mercado Balanza', 10837244627, 'POS'),
	(24437, 'Bodega Vibes', 18310459, 'POS'),
	(24444, 'Chifa Registro',10649726833, 'POS'),
	(24445, 'Movilidad Producción',10139227475, 'POS'),
	(24447, 'Chifa Girlpower', 10245885292, 'POS'),
	(24450, 'Tienda Encuadres', 10432837663, 'POS'),
	(24452, 'Tienda Cúspides',66842192, 'POS'),
	(24454, 'Bodega Universum',10236002991, 'POS'),
	(24457, 'Movilidad Físicos',10534346976, 'POS'),
	(24461, 'Restaurante Fábricas', 10381256192, 'POS'),
	(24465, 'Mercado Unique',10245206716, 'POS'),
	(24466, 'Movilidad Bailarinas ',10622078192, 'POS'),
	(24469, 'Movilidad Palacio',10649663259, 'POS'),
	(24472, 'Bodega Paris', 10313469219, 'POS'),
	(24473, 'Tienda Suplemento', 10208838968, 'POS'),
	(24476, 'Mercado Gengibres', 10132761667, 'POS'),
	(24489, 'Restaurante Postres',10514252458, 'POS'),
	(24491, 'Movilidad Pallets',10543157134, 'POS'),
	(24498, 'Chifa Estratos',10327944166, 'POS'),
	(24499, 'Tienda Sakura',10879875754, 'POS'),
	(24500, 'Restaurante Compás', 10928651315, 'POS'),
	(24502, 'Bodega Blanco', 10292145352, 'POS'),
	(24506, 'Movilidad Andros',10658380023, 'POS'),
	(25, 'Bodega Musculares',10853634917, 'Payment Gateway'),
	(30, 'Bodega Musculares',10853634917, 'Payment Link'),
	(26, 'Restaurante Reflector', 20241382756, 'Payment Gateway'),
	(27, 'Mercado Piel',10643453811, 'Payment Gateway'),
	(28, 'Movilidad Horno', 20356724074, 'Payment Gateway'),
	(29, 'Tienda Creativo',10838605847, 'Payment Gateway');
    
INSERT INTO Transactions (merchant_id, month_trx, gpv_usd, count_trx)
VALUES
	(24342,'1/10/2020',423.8951555,24),
	(24342,'1/11/2020',592.9712761,24),
	(24343,'1/09/2020',57.65193312,10),
	(24344,'1/09/2020',0.397988094,2),
	(24349,'1/08/2020',8.568137252,4),
	(24352,'1/08/2020',1.273613341,5),
	(24353,'1/09/2020',65.97017968,3),
	(24353,'1/03/2022',75.15185226,2),
	(24353,'1/04/2022',165.0679435,2),
	(24353,'1/02/2022',299.5037785,4),
	(24353,'1/01/2022',64.15486803,3),
	(24353,'1/08/2021',41.38097793,2),
	(24353,'1/11/2021',198.3989047,3),
	(24353,'1/09/2021',198.0328842,4),
	(24353,'1/06/2021',128.4181864,2),
	(24353,'1/10/2021',308.3221834,4),
	(24353,'1/05/2021',260.8627874,4),
	(24353,'1/04/2021',192.0615258,5),
	(24353,'1/10/2020',67.43570675,2),
	(24353,'1/02/2021',51.26921099,2),
	(24353,'1/03/2021',372.8230149,2),
	(24353,'1/01/2021',76.48162856,3),
	(24353,'1/12/2020',809.3682238,6),
	(24356,'1/08/2020',3.533191836,2),
	(24357,'1/08/2020',9.914401075,3),
	(24357,'1/09/2020',210.1468997,28),
	(24357,'1/03/2021',49.00636503,5),
	(24357,'1/02/2021',21.86258123,11),
	(24357,'1/12/2020',139.8831355,19),
	(24357,'1/11/2020',536.2219807,99),
	(24357,'1/10/2020',507.8075598,126),
	(24358,'1/12/2020',0.36931916,1),
	(24358,'1/10/2020',456.0924409,3),
	(24358,'1/11/2020',89.15786031,1),
	(24358,'1/08/2020',19.92187787,2),
	(24359,'1/08/2020',0.082657881,2),
	(24360,'1/08/2020',0.125840618,1),
	(24360,'1/12/2020',0.09825942,1),
	(24363,'1/08/2020',0.34166971,2),
	(24366,'1/08/2020',539.1519797,44),
	(24366,'1/09/2020',3498.642951,322),
	(24366,'1/10/2020',1555.979132,187),
	(24366,'1/01/2021',3774.690259,229),
	(24366,'1/11/2020',2434.722717,221),
	(24366,'1/04/2021', 5031.762095,368),
	(24366,'1/03/2021',4479.490938,300),
	(24366,'1/12/2020', 2043.135855,284),
	(24366,'1/02/2021',2268.229649,301),
	(24366,'1/05/2022',1381.954787,149),
	(24366,'1/02/2022',3632.872244,265),
	(24366,'1/04/2022',4809.646349,408),
	(24366,'1/03/2022',6849.189906,306),
	(24366,'1/07/2021',6814.031482,603),
	(24366,'1/12/2021',3576.861087,351),
	(24366,'1/06/2021',5803.124694,317),
	(24366,'1/09/2021',5970.803793,423),
	(24366,'1/11/2021',4587.0409,286),
	(24366,'1/05/2021',4702.322239,265),
	(24366,'1/08/2021',5751.553376,287),
	(24366,'1/10/2021',6030.874341,423),
	(24366,'1/01/2022',3548.692815,297),
	(24373,'1/08/2020',11.66741192,3),
	(24377,'1/01/2021',0.098402908,1),
	(24378,'1/08/2020',0.176478811,2),
	(24379,'1/08/2020',0.553559412,2),
	(24380,'1/09/2020',3.622227369,2),
	(24384,'1/01/2021',0.084182599,1),
	(24385,'1/01/2021',72.26233069,4),
	(24385,'1/04/2021',25.00891892,6),
	(24385,'1/03/2021',0.327424129,1),
	(24385,'1/11/2020',1.015646897,5),
	(24385,'1/08/2020',0.57659801,2),
	(24385,'1/10/2021',12.88464895,1),
	(24385,'1/11/2021',7.484112022,2),
	(24385,'1/07/2021',10.3026517,1),
	(24385,'1/01/2022',7.583618064,1),
	(24385,'1/05/2022',11.3468197,2),
	(24385,'1/04/2022',17.01113143,7),
	(24385,'1/02/2022',8.118514637,2),
	(24386,'1/08/2020',0.950663115,3),
	(24389,'1/09/2020',32.55713301,5),
	(24389,'1/08/2020',6.922768203,4),
	(24389,'1/11/2020',44.26499537,4),
	(24389,'1/10/2020',52.88969869,5),
	(24401,'1/10/2020',24.31275822,1),
	(24401,'1/03/2021',70.35708291,3),
	(24354,'1/11/2020',40.34437821,4),
	(24401,'1/04/2021',36.15413888,2),
	(24401,'1/01/2021',105.8398803,1),
	(24401,'1/04/2022',91.3612481,1),
	(24401,'1/03/2022',360.0839835,4),
	(24401,'1/02/2022',608.8055883,7),
	(24481,'1/12/2021',92.27673893,5),
	(24401,'1/09/2021',304.8137369,7),
	(24401,'1/06/2021',50.56596493,1),
	(24401,'1/10/2021',49.53068261,2),
	(24401,'1/01/2022',383.5403745,6),
	(24401,'1/08/2021',186.2058879,7),
	(24401,'1/05/2021',111.5739419,4),
	(24401,'1/11/2021',1364.460635,23),
	(24407,'1/07/2021',98.39709566,3),
	(24407,'1/08/2021',29.10864135,2),
	(24407,'1/05/2021',160.1008132,3),
	(24407,'1/06/2021',24.37440924,2),
	(24407,'1/01/2021',88.27531783,6),
	(24407,'1/12/2020',897.2703556,29),
	(24407,'1/04/2021',37.70247781,1),
	(24407,'1/11/2020',169.73354,16),
	(24407,'1/10/2020',178.90971974,17),
	(24407,'1/08/2020',69.30498378,2),
	(24407,'1/09/2020',265.1948461,7),
	(24409,'1/08/2020',0.532252266,2),
	(24409,'1/12/2020',93.55007296,4),
	(24416,'1/09/2020',0.884921193,5),
	(24417,'1/09/2020',0.295283393,2),
	(24417,'1/11/2020',0.58809448,2),
	(24419,'1/08/2020', 0.849804831,7),
	(24419,'1/09/2020', 9.816434556,2),
	(24424,'1/10/2020', 0.581648159,1),
	(24425,'1/09/2020',1.463998487,4),
	(24429,'1/10/2020',0.980195264,2),
	(24429,'1/12/2020',14.83461889,1),
	(24430,'1/12/2020',12.10212407,2),
	(24430,'1/11/2020',181.6255544,9),
	(24430,'1/10/2020',9.054796826,2),
	(24430,'1/04/2021',1.70568612,1),
	(24430,'1/03/2021',18.87391666,4),
	(24430,'1/09/2020',205.1454534,17),
	(24432,'1/11/2020',21.35836241,2),
	(24432,'1/12/2020',58.80543806,5),
	(24432,'1/10/2020',3.243721754,1),
	(24434,'1/09/2020',0.480977028,2),
	(24437,'1/09/2020',0.344092815,1),
	(24437,'1/03/2021',735.6804934,6),
	(24437,'1/01/2021',2605.731741,6),
	(24437,'1/03/2021',735.6804934,6),
	(24437,'1/01/2021',2605.731741,6),
	(24437,'1/10/2020',329.1478759,4),
	(24437,'1/12/2020',1514.955504,5),
	(24437,'1/04/2021',643.398758,3),
	(24437,'1/11/2020',1521.579628,7),
	(24437,'1/02/2021',2035.178749,6),
	(24437,'1/08/2021',1092.57402,3),
	(24437,'1/01/2022',1495.627949,5),
	(24437,'1/07/2021',762.8891272,4),
	(24437,'1/09/2021',2187.800906,7),
	(24437,'1/10/2021',298.9995454,3),
	(24437,'1/12/2021',940.2877762,8),
	(24437,'1/06/2021',1165.768034,16),
	(24437,'1/05/2021',1018.117484,1),
	(24437,'1/11/2021',834.4633363,8),
	(24444,'1/08/2020',14.06718153,2),
	(24445,'1/08/2020',34.75513771,4),
	(24445,'1/09/2020',50.672642,3),
	(24445,'1/10/2020',16.09389408,2),
	(24447,'1/09/2020',1795.073317,185),
	(24450,'1/10/2020',0.582361323,1),
	(24452,'1/10/2020',1313.800765,85),
	(24452,'1/12/2020',1871.205515,85),
	(24452,'1/10/2020',1313.800765,85),
	(24452,'1/12/2020',1871.205515,85),
	(24452,'1/02/2021',874.0742863,20),
	(24452,'1/01/2021',1758.027743,40),
	(24452,'1/03/2021',1027.562883,33),
	(24452,'1/04/2021',451.9347225,26),
	(24452,'1/11/2020',1523.70181,45),
	(24452,'1/09/2020',803.6553082,45),
	(24452,'1/08/2020',1359.534475,35),
	(24452,'1/03/2022',393.2520618,9),
	(24452,'1/04/2022',215.7506543,9),
	(24452,'1/02/2022',316.5249424,8),
	(24452,'1/12/2021',942.500706,13),
	(24452,'1/05/2021',584.8909619,25),
	(24452,'1/07/2021',320.9966915,11),
	(24452,'1/01/2022',499.661199,9),
	(24452,'1/10/2021',616.5250388,17),
	(24452,'1/06/2021',83.8595233,5),
	(24452,'1/08/2021',704.1880857,18),
	(24452,'1/11/2021',518.6110418,23),
	(24452,'1/09/2021',526.640984,28),
	(24454,'1/12/2020',61.31977173,4),
	(24457,'1/12/2020',165.7528457,4),
	(24457,'1/01/2021',247.9379721,2),
	(24457,'1/10/2020',130.8676792,2),
	(24461,'1/08/2020',12.1697939,1),
	(24461,'1/09/2020',37.01580979,3),
	(24465,'1/08/2020',0.580107387,2),
	(24466,'1/09/2020',4.94832895,6),
	(24466,'1/01/2021',15.74620554,3),
	(24466,'1/11/2020',21.85994162,1),
	(24466,'1/12/2020',4.835099377,2),
	(24469,'1/04/2021',101.3287375,2),
	(24469,'1/03/2021',0.652784885,5),
	(24469,'1/08/2020',1.031410812,3),
	(24469,'1/06/2021',271.9449823,2),
	(24469,'1/09/2021',86.29259499,3),
	(24472, '1/09/2020',1.512356068,5),
	(24473,'1/09/2020',0.584277593,1),
	(24476,'1/09/2020',4.606472965,3),
	(24489,'1/08/2020',0.466880784,2),
	(24489,'1/09/2020',0.863160261,2),
	(24491,'1/09/2020',327.2794329,24),
	(24491,'1/05/2021',47.57447793,2),
	(24491,'1/06/2021',145.0153966,11),
	(24491,'1/07/2021',64.3284726,3),
	(24491,'1/08/2021',121.9663407,4),
	(24491,'1/01/2021',141.836714,7),
	(24491,'1/11/2020',184.3386885,8),
	(24491,'1/10/2020',134.5420764,8),
	(24491,'1/12/2020',346.3589895,28),
	(24498,'1/11/2020',397.9786478,8),
	(24498,'1/09/2020',378.3900711,4),
	(24498,'1/08/2020',2.394564024,8),
	(24499,'1/09/2020',1841.436378,7),
	(24499,'1/08/2020',1.015917264,4),
	(24499,'1/01/2021',35.63703162,1),
	(24499,'1/10/2020',1373.48667,11),
	(24499,'1/02/2021',1289.69582,18),
	(24499,'1/12/2020',203.7864805,5),
	(24499,'1/11/2020',889.6646444,3),
	(24499,'1/04/2021',1184.732997,21),
	(24499,'1/05/2021',1458.069002,16),
	(24500,'1/08/2020',5.239808202,3),
	(24502,'1/09/2020',0.691880998,3),
	(24506,'1/08/2020',295.9269529,21),
	(24506,'1/08/2020',295.9269529,21),
	(24506,'1/09/2020',531.5848895,44),
	(24506,'1/06/2021',1868.322739,162),
	(24506,'1/12/2021',1609.385263,250),
	(24506,'1/05/2021',1430.954556,218),
	(24506,'1/11/2021',1854.20917,277),
	(24506,'1/08/2021',2061.836385,310),
	(24506,'1/10/2021',2762.927625,237),
	(24506,'1/09/2021',2226.416765,264),
	(24506,'1/01/2022',1649.430995,214),
	(24506,'1/07/2021',1967.526552,297),
	(24506,'1/01/2021',599.9958791,74),
	(24506,'1/03/2021',888.6181192,129),
	(24506,'1/11/2020',872.9527843,81),
	(24506,'1/04/2021',1122.142973,196),
	(24506,'1/10/2020',620.2806176,96),
	(24506,'1/12/2020',666.0363623,86),
	(24506,'1/02/2021',1072.451039,226),
	(24506,'1/04/2022',1803.13654,313),
	(24506,'1/05/2022',534.475905,72),
	(24506,'1/02/2022',1776.859865,154),
	(24506,'1/03/2022',2528.476177,303),
	(25,'1/03/2019',70255.91,368),
	(25,'1/10/2019',2510.72,4),
	(25,'1/01/2018',26114.13,76),
	(25,'1/05/2016',16661.2,72),
	(25,'1/12/2017',25031.32,77),
	(25,'1/03/2016',9116.55,35),
	(25,'1/01/2019',23506.25,172),
	(30,'1/08/2020',9.6,1),
	(25,'1/10/2017',29610.92,64),
	(25,'1/08/2020',61606.26,155),
	(25,'1/09/2017',20172.96,62),
	(25,'1/11/2017',38654.34,113),
	(25,'1/04/2019',46970.93,260),
	(25,'1/12/2018',30881.55,160),
	(25,'1/08/2016',30207.04,72),
	(25,'1/11/2016',35081.67,89),
	(25,'1/04/2017',21932.45,50),
	(25,'1/05/2018',20576.61,106),
	(25,'1/04/2018',23299.52,92),
	(25,'1/06/2017',11878.87,44),
	(25,'1/08/2017',14607.68,54),
	(25,'1/08/2018',26564.26,124),
	(25,'1/10/2018',31921.13,102),
	(25,'1/02/2019',45134.29,193),
	(25,'1/01/2017',20466.17,71),
	(25,'1/10/2016',24707.36,77),
	(25,'1/05/2017',12539.11,48),
	(25,'1/06/2018',13543.87,67),
	(25,'1/04/2016',20541.23,42),
	(25,'1/05/2020',34393.52,110),
	(25,'1/05/2019',33101.48,147),
	(25,'1/05/2019',33101.48,147),
	(30,'1/04/2020',12,1),
	(25,'1/04/2020',10983.36,68),
	(25,'1/03/2020',36711.36,153),
	(25,'1/03/2017',14145.37,52),
	(25,'1/07/2016',30613.71,66),
	(25,'1/01/2020',37155.29,131),
	(25,'1/02/2020',64169.6,200),
	(25,'1/09/2018',39474.89,110),
	(25,'1/07/2020',67727.17,237),
	(25,'1/06/2016',14427.4,54),
	(25,'1/03/2018',9542.56,61),
	(25,'1/12/2019',3.882352941,2),
	(25,'1/09/2016',44178.77,102),
	(25,'1/06/2020',48723.07,176),
	(25,'1/07/2019',4393.1,19),
	(25,'1/02/2018',13394.46412,59),
	(25,'1/02/2018',13394.46412,59),
	(25,'1/07/2017',20587.77,76),
	(25,'1/11/2018',55254.41,233),
	(25,'1/02/2017',14340,46),
	(25,'1/09/2020',49594.21,185),
	(25,'1/06/2019',15937.18,83),
	(25,'1/10/2020',142836.66,350),
	(25,'1/02/2021',3234.411765,3),
	(25,'1/12/2020',53598.58,344),
	(25,'1/11/2020',91915.22,500),
	(25,'1/01/2021',3570.403529,31),
	(26,'1/04/2016',28.76470588,2),
	(27,'1/03/2016',76.47058824,5),
	(28,'1/07/2019',102.0588235,1),
	(28,'1/04/2016',193.8970588,13),
	(28,'1/04/2016',193.8970588,13),
	(28,'1/09/2017',125.5882353,3),
	(28,'1/07/2018',103.2352941,2),
	(28,'1/01/2018',226.7647059,7),
	(28,'1/10/2019',38.23529412,1),
	(28,'1/01/2019',28.5294117,1),
	(28,'1/06/2016',311.1764706,10),
	(28,'1/01/2017',90.58823529,3),
	(28,'1/08/2017',40.88235294,2),
	(28,'1/05/2017',79.7058823,3),
	(28,'1/12/2019',114.705882,3),
	(28,'1/06/2017',231.7647055,4),
	(28,'1/12/2016',217.352941,5),
	(28,'1/10/2016',183.235294,4),
	(28,'1/09/2016',162.352941,5),
	(28,'1/05/2018',252.7941176,6),
	(28,'1/06/2018',19.70588235,1),
	(28, '1/08/2018',54.70588235,2),
	(28,'1/11/2019',38.23529412,1),
	(28,'1/11/2017',255.5882353,3),
	(28,'1/03/2018',39.41176471,2),
	(28,'1/05/2016',50.95588235,2),
	(28,'1/04/2018',90,3),
	(28,'1/11/2018',81.47058824,1),
	(28,'1/03/2017',40.14705882,1),
	(28,'1/04/2017',250.5882353,6),
	(28,'1/11/2016',224.2647059,4),
	(28,'1/07/2016',155.8823529,4),
	(28,'1/02/2018',118.5294118,4),
	(28,'1/08/2016',67.94117647,3),
	(28,'1/12/2018',205.2941176,3),
	(28,'1/01/2020',38.23529412,1),
	(28,'1/07/2017',163.5294118,3),
	(28,'1/12/2017',414.7058824,5),
	(28,'1/09/2018',52.64705882,2),
	(29,'1/03/2016',201.7647059,11),
	(29,'1/05/2016',85.29411765,2),
	(29,'1/04/2016',360.1911765,15);
   
INSERT INTO RUC_segment (merchant_ruc, segment)
VALUES
	(20639073349, 'Medium'),
	(20847258296, 'Corp'),
	(20612481970, 'Corp'),
	(20983208130, 'Small'),
	(20135448574, 'Small'),
	(20771211723, 'Corp'),
	(36117719, 'Corp'),
	(20784634554, 'Small'),
	(20777222331, 'Medium'),
	(10652893, 'Small'),
	(10358837873, 'Micro'),
	(10658253471, 'Micro'),
	(10598678465, 'Small'),
	(10661609432, 'Small'),
	(10103950737, 'Corp'),
	(10659251085, 'Micro'),
	(10384816897, 'Micro'),
	(10181431099, 'Corp'),
	(10181431099, 'Corp'),
	(10520680879, 'Medium'),
	(10462520240, 'Micro'),
	(10116772074, 'Micro'),
	(10210030687, 'Micro'),
	(10431114886, 'Medium'),
	(75326399, 'Small'),
	(10625782672, 'Corp'),
	(10566162740, 'Corp'),
	(10436642592, 'Small'),
	(10988229106, 'Corp'),
	(10626077711, 'Small'),
	(10273073417, 'Small'),
	(10901586976, 'Small'),
	(10317494845, 'Corp'),
	(10837244627, 'Small'),
	(18310459, 'Small'),
	(18310459, 'Small'),
	(10649726833, 'Medium'),
	(10139227475, 'Micro'),
	(10245885292, 'Corp'),
	(10432837663, 'Micro'),
	(66842192, 'Medium'),
	(10236002991, 'Micro'),
	(10534346976, 'Corp'),
	(10381256192, 'Micro'),
	(10245206716, 'Corp'),
	(10622078192, 'Small'),
	(10649663259, 'Micro'),
	(10313469219, 'Corp'),
	(10208838968, 'Corp'),
	(10132761667, 'Small'),
	(10543157134, 'Micro'),
	(10327944166, 'Medium'),
	(10879875754, 'Corp'),
	(10928651315, 'Medium'),
	(10292145352, 'Corp'),
	(10658380023, 'Micro'),
	(10853634917, 'Medium'),
	(20241382756, 'Micro'),
	(10643453811, 'Medium'),
	(20356724074, 'Small'),
	(10838605847, 'Corp');
	
/* ----- Exploring Tables ------ */
SELECT * FROM Merchants;
SELECT * FROM Transactions;
SELECT * FROM RUC_segment;

-- -----------------------------------------------------
/* ----- Answer Questions - Querys ------ */

/* 1. Create a table with all the columns (unified table) of the 3 tables (without repeating). 
	  The granularity is monthly per merchant (as in the transaction table).*/
CREATE TEMPORARY TABLE table_unified AS 
	(SELECT m.merchant_id, m.merchant_name, m.merchant_ruc, m.model_service, 
	t.month_trx, ROUND(t.gpv_usd, 2) AS gpv_usd, t.count_trx, s.segment
	FROM Merchants m 
	JOIN Transactions t
	ON m.merchant_id = t.merchant_id
	JOIN RUC_segment s
	ON m.merchant_ruc = s.merchant_ruc);

SELECT * FROM table_unified;

/* 2. Answer the following questions, keeping in mind that when asked for the merchant, 
	  use merchant_name, not merchant_id: */

/* 2.1.	Which merchant had the highest GPV in August 2020? How much was the value, 
		how many products does it use and note if more than one? */
SELECT merchant_name, month_trx, MAX(gpv_usd), 
CONCAT(GROUP_CONCAT(DISTINCT model_service SEPARATOR ', '), ' (', 
COUNT(DISTINCT model_service), ')') AS services_used_COUNT
FROM table_unified
WHERE month_trx LIKE '%08/2020'
GROUP BY merchant_name, month_trx
ORDER BY 3 DESC;

/* 2.2.	Which segment had the highest number of transactions in the 
		first quarter of 2021? */
SELECT segment, MAX(count_trx),
LEFT(GROUP_CONCAT(month_trx ORDER BY count_trx DESC), 9) AS month_trxs
FROM table_unified
WHERE month_trx LIKE '%01/2021' OR month_trx LIKE '%02/2021' OR month_trx LIKE '%03/2021'
GROUP BY segment
ORDER BY 2 DESC;

/* 2.3.	Which merchant has the longest tenure (i.e., the one who has had 
		the most months from when he started to his last month of transactions)? */
SELECT merchant_name, COUNT(DISTINCT month_trx) AS count_months
FROM table_unified
GROUP BY merchant_name
ORDER BY 2 DESC;

/* 2.4.	For each model service: */
/* 2.4.1. Which is the month with the highest volume of transactions 
		  (Number of transactions, NOT amount)? */
SELECT model_service, MAX(count_trx), 
LEFT(GROUP_CONCAT(month_trx ORDER BY count_trx DESC), 9) AS month_trxs
FROM table_unified
GROUP BY model_service
ORDER BY 2 DESC;

/* 2.4.2. How much was the average transaction (in dollars)?*/
SELECT model_service, ROUND(AVG(gpv_usd), 2) AS AVG_TRX_USD
FROM table_unified
GROUP BY model_service
ORDER BY 2 DESC;

-- -----------END -------------------------
